<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>GPS位置固定AR（10地点）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- A-Frame + AR.js -->
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.1/aframe/build/aframe-ar.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    #hud {
      position: fixed;
      top: 8px;
      left: 8px;
      background: rgba(0,0,0,.55);
      color: #fff;
      font-size: 12px;
      line-height: 1.4;
      padding: 6px 8px;
      border-radius: 4px;
      z-index: 9999;
      white-space: pre-line;
      max-width: 90vw;
    }
    #permissionOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #fff;
      z-index: 10000;
      text-align: center;
      padding: 20px;
    }
    #permissionOverlay button {
      margin-top: 20px;
      background: #007bff;
      border: none;
      color: #fff;
      padding: 14px 26px;
      font-size: 18px;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<!-- iPhone用 許可オーバーレイ -->
<div id="permissionOverlay">
  <div>カメラと方位の許可が必要です。<br>「ARを開始する」をタップしてください。</div>
  <button id="startBtn">ARを開始する</button>
</div>

<!-- 現在位置表示 -->
<div id="hud">位置を取得中…</div>

<a-scene
  id="scene"
  vr-mode-ui="enabled: false"
  embedded
  arjs="sourceType: webcam; debugUIEnabled: false;"
  renderer="antialias: true; alpha: true"
  style="width: 100vw; height: 100vh;"
>
  <a-camera gps-camera rotation-reader></a-camera>

  <!-- ① タスパークホテル -->
  <a-box gps-entity-place="latitude: 38.10148128126027; longitude: 140.0433090680094;"
         color="#ff4444"
         scale="10 10 10"
         position="0 0 0">
  </a-box>

  <!-- ② 道の駅ながい -->
  <a-sphere gps-entity-place="latitude: 38.108970970886325; longitude: 140.04382939078403;"
            color="#448aff"
            scale="10 10 10"
            position="0 0 0">
  </a-sphere>

  <!-- ③ 南長井小学校 -->
  <a-cone gps-entity-place="latitude: 38.107796313044474; longitude: 140.04269068239356;"
          color="#4caf50"
          scale="10 10 10"
          position="0 0 0">
  </a-cone>

  <!-- ④ こざくら館 -->
  <a-cylinder gps-entity-place="latitude: 38.110963329145335; longitude: 140.03632275489852;"
              color="#ff9800"
              scale="10 10 10"
              position="0 0 0">
  </a-cylinder>

  <!-- ⑤ 丸大扇屋 -->
  <a-torus gps-entity-place="latitude: 38.11228246118919; longitude: 140.036198935986;"
           color="#9c27b0"
           radius="5"
           radius-tubular="0.6"
           scale="1 1 1"
           position="0 0 0">
  </a-torus>

  <!-- ⑥ 長井市役所 -->
  <a-box gps-entity-place="latitude: 38.1063333593554; longitude: 140.033892868012;"
         color="#00bcd4"
         scale="10 10 10"
         position="0 0 0">
  </a-box>

  <!-- ⑦ 長井工業高校 -->
  <a-sphere gps-entity-place="latitude: 38.114426209437404; longitude: 140.03013087985815;"
            color="#cddc39"
            scale="10 10 10"
            position="0 0 0">
  </a-sphere>

  <!-- ⑧ 長井高校 -->
  <a-cone gps-entity-place="latitude: 38.097283861825424; longitude: 140.0380452392042;"
          color="#ff6f00"
          scale="10 10 10"
          position="0 0 0">
  </a-cone>

  <!-- ⑨ 南長井 -->
  <a-cylinder gps-entity-place="latitude: 38.09769549394771; longitude: 140.03458623775896;"
              color="#795548"
              scale="10 10 10"
              position="0 0 0">
  </a-cylinder>

  <!-- ⑩ くるんと -->
  <a-box gps-entity-place="latitude: 38.10491876278905; longitude: 140.03466346205656;"
         color="#03a9f4"
         scale="10 10 10"
         position="0 0 0">
  </a-box>

</a-scene>

<script>
const hud = document.getElementById('hud');

document.getElementById('startBtn').addEventListener('click', async () => {
  // iOSの方位センサー許可
  if (typeof DeviceOrientationEvent !== 'undefined' &&
      typeof DeviceOrientationEvent.requestPermission === 'function') {
    try {
      await DeviceOrientationEvent.requestPermission();
    } catch(e) {
      console.warn(e);
    }
  }
  // 位置もこのクリックの中で一度読んでおく
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      pos => {
        const {latitude, longitude, accuracy} = pos.coords;
        hud.textContent =
          `lat: ${latitude.toFixed(6)}\nlon: ${longitude.toFixed(6)}\n±${accuracy.toFixed(1)}m`;
      },
      err => {
        hud.textContent = '位置情報が取得できません: ' + err.message;
      },
      {enableHighAccuracy: true}
    );
  }
  // オーバーレイを消す
  document.getElementById('permissionOverlay').style.display = 'none';
});

// 位置を更新するたびにHUDだけ書き換えたいとき
window.addEventListener('load', () => {
  const cam = document.querySelector('[gps-camera]');
  if (!cam) return;
  cam.addEventListener('gps-camera-update-position', e => {
    const {latitude, longitude, accuracy} = e.detail.position;
    hud.textContent =
      `lat: ${latitude.toFixed(6)}\nlon: ${longitude.toFixed(6)}\n±${(accuracy || 0).toFixed(1)}m`;
  });
});
</script>
</body>
</html>
